{% extends "base.html" %}

{% block headline %}{{ task.question }}{% endblock %}
{% block subheadline %}<span class="badge badge-info"">{{ task.keyword }}</span>{% endblock %}
{% block content %}
  <div class="row border" id="taskInfo">
        <div class="col-lg-3 border-right">Address: {{conShort}}</div>
        <div class="col-lg-3 border-right">Owner: {{ownShort}}</div>
        <div class="col-lg-3 border-right" id="correctorInfo">Corrector: {{corShort}}</div>
        <div class="col-lg-3">Created at: {{task.created_utc}}</div>
  </div>

  <div class="list-group" id="answerList">
    {% for a in answers %}
      {% include "answeritem.html" %}
    {% else %}
      This task has not been solved by anyone yet.
    {% endfor %}
  </div>
{% endblock %}

{% block scripts %}
<script>
  app.account().then(function(acc){
    if ('{{task.corrector}}'.toLowerCase() == acc){
      $('#answerList').children().each(function(i) {
        $(this).find(".scoreRow").append(
          '<span class="float-right form-inline">' +
          '<input class="form-control scoreInput"/>' +
          '<button type="button" class="btn btn-primary mark">' +
          'Mark' +
          '</button>' +
          '</span>'
        );

        //if this answer was already marked
        if (!$(this).find(".scoreRow").text().includes('?')) {
          $(this).find('button').text('Mark again');
        }
      });
      $('#correctorInfo').text('Corrector: You');
      //TODO: test once as non corrector if i can mark
    }
  })
  .then(function(){
    $(".mark").on( "click", function() {
      var contract = '{{task.contract}}';
      var testee = $(this).closest('.list-group-item').find('.answerTestee').text().split(' ')[1];
      var score = parseInt($(this).siblings('.scoreInput').val());
      console.log("DER CONTRACT:");
      console.log(contract);
      console.log("DER TESTEE:");
      console.log(testee);
      console.log("DER SCORE:");
      console.log(score);

      app.mark(contract, testee, score);
    });
  });

</script>
{% endblock %}
